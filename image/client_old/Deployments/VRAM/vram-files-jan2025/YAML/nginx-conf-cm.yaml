kind: ConfigMap
apiVersion: v1
metadata:
  name: nginx-conf
  namespace: vram
  uid: 4f6b9a8f-36e5-476c-b297-d18bad134f6f
  resourceVersion: '960661159'
  creationTimestamp: '2024-02-22T18:53:40Z'
  managedFields:
    - manager: Mozilla
      operation: Update
      apiVersion: v1
      time: '2024-02-22T18:53:40Z'
      fieldsType: FieldsV1
      fieldsV1:
        'f:data':
          .: {}
          'f:nginx.conf': {}
data:
  nginx.conf: "#### Default nginx.conf for VRAM environments (using SCORE)\r\n\r\n\r\n# The user directive is ignored because the container\r\n# is run by user `nginx` and is unprivileged. This\r\n# prevents nginx from switching users. Enabling this\r\n# directive will simply cause nginx to ignore and\r\n# proceed with the default `nginx` user.\r\nuser  nginx;\r\nworker_processes  auto;\r\npid        /var/cache/nginx/nginx.pid;\r\n\r\n#error_log stderr;\r\n# CIS NGINX Benchmark\r\n# 3.3 Ensure error logging is enabled and set to the info logging level \r\nerror_log  /var/log/nginx/error.log  info;\r\n\r\nevents {\r\n    worker_connections 1024;\r\n}\r\nhttp {\r\n    # VRAM custom logs. The x-subject-cn is only used in the NIPR CEDC\r\n    log_format  main  '[id=$request_id] [local_time=$time_local] [remote_addr=$remote_addr] [ssl_client_s_dn=$ssl_client_s_dn] '\r\n                        '[remote_user=$remote_user] [request=$request] [status=$status] '\r\n                        '[body_bytes_sent=$body_bytes_sent] [http_referrer=$http_referer] '\r\n                        '[http_user_agent=$http_user_agent] [http_x_forwarded_for=$http_x_forwarded_for] '\r\n                        '[upstream_response_time=$upstream_response_time] [sni=$ssl_server_name] [user_ip=$http_user_ip] '\r\n                        '[x-subject-cn=$http_x_subject_cn]';\r\n    access_log  /dev/stdout  main;\r\n    sendfile            on;\r\n    tcp_nopush          on;\r\n    tcp_nodelay         on;\r\n    keepalive_timeout   65;\r\n    types_hash_max_size 4096;\r\n    include             /etc/nginx/mime.types;\r\n    default_type        application/octet-stream;\r\n    large_client_header_buffers 2 1k;\r\n    client_max_body_size 8m;\r\n    client_header_buffer_size 1k;\r\n    client_body_buffer_size 100K;\r\n    server_tokens off;  # VRAM-1025\r\n    server_names_hash_max_size 128;\r\n    server_names_hash_bucket_size 128;\r\n    ssl_protocols TLSv1.2 TLSv1.3;\r\n    ssl_prefer_server_ciphers on;\r\n    ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256';\r\n    ssl_session_cache shared:SSL:10m;\r\n    ssl_session_timeout 5m;\r\n    ssl_session_tickets off;\r\n    proxy_set_header X-Forwarded-Host $host;\r\n    proxy_set_header X-Forwarded-Server $host;\r\n    proxy_set_header X-Forwarded-Proto https;\r\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n    proxy_set_header Host $http_host;\r\n    proxy_set_header X-SSL-CERT $ssl_client_escaped_cert;\r\n    proxy_set_header ClientDN $ssl_client_s_dn;\r\n    proxy_set_header X-Request-Id $request_id;\r\n    proxy_set_header Upgrade $http_upgrade;\r\n    proxy_set_header Connection \"upgrade\";\r\n    proxy_ssl_session_reuse on;\r\n    proxy_hide_header X-XSS-Protection; # remove duplicate when proxied server already has this header\r\n    proxy_hide_header X-Content-Type-Options; # remove duplicate when proxied server already has this header\r\n    # Following add_header entries added for STIG 03/05/2018\r\n    # STIG ID: ???\r\n    add_header X-Frame-Options SAMEORIGIN;\r\n    # STIG ID: ???\r\n    add_header X-Content-Type-Options nosniff;\r\n    # STIG ID: ???\r\n    add_header X-XSS-Protection \"1; mode=block\";\r\n    # STIG ID: ???\r\n    add_header Allow \"GET, POST, HEAD\" always;\r\n    # STIG ID: TCAT-AS-000030\r\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\r\n\r\n    # Load modular configuration files from the /etc/nginx/conf.d directory.\r\n    # See http://nginx.org/en/docs/ngx_core_module.html#include\r\n    # for more information.\r\n    include /etc/nginx/conf.d/*.conf;\r\n}\r\n"
